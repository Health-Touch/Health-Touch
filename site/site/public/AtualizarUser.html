<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/AtualizarUser.css">
    <title>Usuário | Health Touch</title>
    <link rel="shortcut icon" type="imagex/png" href="./assets/img/logo_icon.png" />
</head>

<body>
    <div class="divPai">
        <!-- inicio menu lateral -->
        <div class="divPaiLateral">
            <div class="filhoLateral">

                <div class="divNomeEmpresa">

                    <p id="textoEmpresa">Bem Vindo</p>
                    <p id="nomeEmpresa">Bem Vindo <br><span> Nome da Empresa </span></p>
                </div>

                <div class="divMainMenu">
                    <p id="pMainMenu">MAIN MENU</p>
                </div>

                <div class="divPaiOpcoesMenu">
                    <a href="setores.html" id="pMenuLateral">
                        <div class="divHome">
                            <img id="iconMenuLateralHome" src="assets/img/grafico-de-setores.png">
                            <div class="divEspaco"></div>
                            Setores
                        </div>
                    </a>

                    <a href="cadastroMaquinas.html" id="pMenuLateral">
                        <div class="divComputador">
                            <img id="iconComputadorLateral" src="assets/img/computador (4).png">
                            <div class="divEspaco"></div>
                            Cadastro Máquinas
                        </div>
                    </a>

                    <a href="analiseMaquinaTI.html" id="pMenuLateral">
                        <div class="divCadastroComputador">
                            <img id="iconComputadorCadLateral" src="assets/img/definicoes.png">
                            <div class="divEspaco"></div>
                            Análise Máquinas
                        </div>
                    </a>

                    <a href="cadastroFuncionarios.html" id="pMenuLateral">
                        <div class="divAnaliseEquipe">
                            <img id="iconAnaliseEquipe" src="assets/img/carteira-de-identidade.png">
                            <div class="divEspaco"></div>
                            Cadastro Equipe
                        </div>
                    </a>

                    <a href="analiseFuncionario.html" id="pMenuLateral">
                        <div class="divDashboards">
                            <img id="iconDashboardsLateral" src="assets/img/equipe.png">
                            <div class="divEspaco"></div>
                            Análise Funcionários
                        </div>
                    </a>

                    <a href="" id="pMenuLateral">
                        <div class="divCadastroEquipe">
                            <img id="iconCadastroEquipe" src="assets/img/mais (2).png">
                            <div class="divEspaco"></div>
                            Dashboards
                        </div>
                    </a>
                </div>

                <div class="divEspacoV2"></div>

                <div class="divHelp">
                    <p id="pHelp">HELP</p>
                </div>

                <div class="divPaiHelpMenu">
                    <a href="SuporteHealthTooch.html" id="pMenuLateral">
                        <div class="divHelpDesk">
                            <img id="iconHelpDesk" src="assets/img/suporte-ao-cliente.png">
                            <div class="divEspaco"></div>
                            HelpDesk
                        </div>
                    </a>
                    <a href="AtualizarUser.html" id="pMenuLateral">
                        <div class="divConfiguracoes">
                            <img id="iconConfiguracoes" src="assets/img/botao-de-roda-dentada-de-configuracoes.png">
                            <div class="divEspaco"></div>
                            Configurações
                        </div>
                    </a>
                    <a href="index.html">
                        <img id="logoMenuLateral" src="assets/img/logoMenu.png">
                    </a>
                </div>
            </div>
        </div>
        <!-- fim do menu lateral -->

        <!-- inicio do cabeçalho -->
        <div class="divPaiCabecalho">
            <div class="filhoCabecalho">

                <div class="esquerdaCabecalho">
                    <div class="fundoInputPesquisa">
                        <input type="text" class="inputLogin" placeholder="Pesquisar"></input>
                        <img src="assets/img/lupa.png" class="lupaBusca">
                    </div>
                </div>

                <div class="direitaCabecalho">
                    <img class="emailIconCabecalho" src="assets/img/iconEmail.png">
                    <img class="sinoIconCabecalho" src="assets/img/notificacaoIcon.png">
                    <div class="divPerfilCabecalho">
                        <img class="iconPerfilCabecalho" src="assets/img/fotoPerfil.png">
                        <div class="textosIcon">
                            <p id="tituloPerfil">Anthony Bento</p>
                            <p id="cargoPerfil">CEO</p>
                        </div>
                        <img class="setaPerfilCabecalho" src="assets/img/setaIcon.png">
                    </div>
                </div>

            </div>
            <!-- fim do cabeçalho -->

            <!-- começo conteudo pagina -->
            <div class="divPaiConteudo">
                <div class="AtualizarImg">
                    <img src="assets/img/ExemploUser.jpg" id="FotoUser" alt="">
                    <h1 id="idNomeFoto">Anthony Bento</h1>
                    <h3 id="cargoFoto">CEO</h3>
                </div>
                <div class="AtualizarDados">
                    <div class="divAtualizarDadosLE">
                        <h2>Atualizar <span class="TitFormulario">Dados</span></h2>
                        <div class="divFormulario">
                            <div class="Campo">
                                <p>Nome:</p>
                                <input type="text" id="input_Nome" placeholder="Atualizar Nome">
                            </div>

                            <div class="Campo">
                                <p>Telefone Fixo:</p>
                                <input type="text" id="input_TelFixo" placeholder="(xx) xxxxxxxxx">
                            </div>

                            <div class="Campo">
                                <p>Telefone Celular:</p>
                                <input type="text" id="input_TelCel" placeholder="(xx) xxxxxxxxx">
                            </div>

                            <div class="Campo">
                                <p>CPF: </p>
                                <input type="text" id="input_Cpf" placeholder="xxx.xxx.xxx-xx">
                            </div>

                            <button class="Btn_atualizar" onclick="Btn_atualizarDados()">Atualizar</button>
                        </div>
                    </div>
                    <div class="divAtualizarDadosLD">
                        <h2>Trocar <span class="TitFormulario">Senha</span></h2>
                        <div class="divFormulario">
                            <div class="Campo">
                                <p>Senha Atual:</p>
                                <input type="password" id="input_senhaAtual" placeholder="*********">
                            </div>

                            <div class="Campo">
                                <p>Nova Senha:</p>
                                <input type="password" id="input_NovaSenha" placeholder="*********">
                            </div>

                            <div class="Campo">
                                <p>Confirmar Nova Senha</p>
                                <input type="text" id="input_ConfirmaNovaSenha" placeholder="*********">
                            </div>

                            <button class="Btn_atualizar" onclick="Btn_atualizarSenha()">Atualizar</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- fim conteudo pagina -->
        </div>
    </div>
</body>

</html>

<script>

    function Btn_atualizarDados() {
        var Nome = input_Nome.value;
        var TelFixo = input_TelFixo.value;
        var TelCel = input_TelCel.value;
        var cpf = input_Cpf.value;
        var idColaborador = sessionStorage.ID_COLABORADOR;
        // alert(idColaborador)
        // alert(Nome)
        // alert(TelFixo)
        // alert(TelCel)
        // alert(cpf)

        // Enviando o valor da nova input
        fetch('/usuarios/atualizarDados', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nomeServer: Nome,
                TelFixoServer: TelFixo,
                TelCelServer: TelCel,
                cpfServer: cpf,
                idColaboradorServer: idColaborador
            })
        })
            .then(function (resposta) {
                console.log('resposta: ', resposta)

                if (resposta.ok) {
                    console.log("Cadastro realizado com sucesso! Redirecionando para tela de Login.")
                    resposta.json().then(json => {
                        console.log(json);
                        console.log(JSON.stringify(json));


                        sessionStorage.ID_EMPRESA = json.idEmpresa;
                        // sessionStorage.SOBRENOME_USUARIO = json.sobrenome;
                        // sessionStorage.SENHA_USUARIO = json.senha;

                        setTimeout(function () {
                            window.location = "AtualizarUser.html";
                        }, 1000); // apenas para exibir o loading

                    });
                    limparFormulario()
                } else {
                    throw 'Houve um erro ao tentar realizar o cadastro!'
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`)
            })

        return false
    }

    function Btn_atualizarSenha() {
        var senha = sessionStorage.SENHA_COLABORADOR;
        var SenhaAtual = input_senhaAtual.value;
        var NovaSenha = input_NovaSenha.value;
        var ConfirmaNovaSenha = input_ConfirmaNovaSenha.value;
        var idColaborador = sessionStorage.ID_COLABORADOR
        // alert(senha)
        // alert(SenhaAtual)
        // alert(NovaSenha)
        // alert(ConfirmaNovaSenha)
        // alert(idColaborador)

        if (SenhaAtual == senha & NovaSenha == ConfirmaNovaSenha) {
            // Enviando o valor da nova input
            fetch('/usuarios/atualizarSenha', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    NovaSenhaServer: NovaSenha,
                    idColaboradorServer: idColaborador
                })
            })
                .then(function (resposta) {
                    console.log('resposta: ', resposta)

                    if (resposta.ok) {
                        console.log("Cadastro realizado com sucesso! Redirecionando para tela de Login.")
                        resposta.json().then(json => {
                            console.log(json);
                            console.log(JSON.stringify(json));


                            sessionStorage.ID_EMPRESA = json.idEmpresa;
                            // sessionStorage.SOBRENOME_USUARIO = json.sobrenome;
                            // sessionStorage.SENHA_USUARIO = json.senha;

                            setTimeout(function () {
                                window.location = "AtualizarUser.html";
                            }, 1000); // apenas para exibir o loading

                        });
                        limparFormulario()
                    } else {
                        throw 'Houve um erro ao tentar realizar o cadastro!'
                    }
                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`)
                })
        }
        else{

        }
        return false
    }


    var nome = sessionStorage.NOME_COLABORADOR;
    tituloPerfil.innerHTML = nome;
    idNomeFoto.innerHTML = nome;

    var cargo = sessionStorage.NIVELACESSO_COLABORADOR;
    if (cargo == "RL") {
        cargo = "Representante"
    } else if (cargo == "GT") {
        cargo = "Gerente TI"
    }

    cargoPerfil.innerHTML = cargo;
    cargoFoto.innerHTML = cargo;

    var Empresa = sessionStorage.NOME_FANTASIA_COLABORADOR;
    nomeEmpresa.innerHTML = Empresa;
</script>