<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/baseDash.css">
    <link rel="stylesheet" href="../css/analiseCount.css">
    <title>Análise dos Avisos | Health Touch</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../js/funcoes.js"></script>
    <link rel="shortcut icon" type="imagex/png" href="./assets/img/logo_icon.png" />
</head>
<style>
    .setaPerfilCabecalho:hover {
        cursor: pointer;
    }

    .menuPerfil ul {
        padding: 0;
    }

    .btnSair {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        width: 35px;
        height: 35px;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        position: relative;
        overflow: hidden;
        transition-duration: .3s;
        box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.199);
        background-color: rgb(255, 65, 65);
    }

    .btnSair:hover {
        width: 90px;
        border-radius: 40px;
        transition-duration: .3s;
    }

    .btnSair:hover .sign {
        width: 45%;
        transition-duration: .3s;
    }

    .btnSair:hover .txtBtn {
        opacity: 1;
        width: 70%;
        transition-duration: .3s;
    }

    .sign {
        width: 100%;
        transition-duration: .3s;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .sign svg {
        width: 17px;
    }

    .sign svg path {
        fill: white;
    }

    .txtBtn {
        position: absolute;
        right: 0%;
        width: 0%;
        opacity: 0;
        color: white;
        font-size: 1em;
        font-weight: 600;
        transition-duration: .3s;
    }
</style>

<body onload="buscarMes() ">

    <div class="divPai">
        <!-- inicio menu lateral -->
        <div class="divPaiLateral">
            <div class="filhoLateral">

                <div class="divNomeEmpresa">

                    <p id="textoEmpresa">Bem Vindo</p>
                    <p id="nomeEmpresa">Bem Vindo <br><span> Nome da Empresa </span></p>
                </div>

                <div class="divMainMenu">
                    <p id="pMainMenu">MAIN MENU</p>
                </div>

                <div class="divPaiOpcoesMenu">
                    <a href="../setores.html" class="pMenuLateral">
                        <div class="divHome">
                            <img id="iconMenuLateralHome" src="../assets/img/grafico-de-setores.png">
                            <div class="divEspaco"></div>
                            Setores
                        </div>
                    </a>

                    <a href="../cadastro/cadastroMaquinas.html" class="pMenuLateral"  id="SumirCadMaq">
                        <div class="divComputador">
                            <img id="iconComputadorLateral" src="../assets/img/computador (4).png">
                            <div class="divEspaco"></div>
                            Cadastro Máquinas
                        </div>
                    </a>

                    <a href="../analise/analiseMaquinaTI.html" class="pMenuLateral" id="SumirAnaliseMaq">
                        <div class="divCadastroComputador">
                            <img id="iconComputadorCadLateral" src="../assets/img/definicoes.png">
                            <div class="divEspaco"></div>
                            Análise Máquinas
                        </div>
                    </a>

                    <a href="../cadastro/cadastroFuncionarios.html" class="pMenuLateral" id="SumirCadEquipe">
                        <div class="divAnaliseEquipe">
                            <img id="iconAnaliseEquipe" src="../assets/img/carteira-de-identidade.png">
                            <div class="divEspaco"></div>
                            Cadastro Equipe
                        </div>
                    </a>

                    <a href="../analise/analiseFuncionario.html" class="pMenuLateral" id="SumirAnaliseFunc">
                        <div class="divDashboards">
                            <img id="iconDashboardsLateral" src="../assets/img/equipe.png">
                            <div class="divEspaco"></div>
                            Análise Funcionários
                        </div>
                    </a>
                    <a href="" class="pMenuLateral">
                        <div class="divCadastroEquipe"  id="divCadastroEquipe">
                            <img id="iconCadastroEquipe" src="../assets/img/mais (2).png">
                            <div class="divEspaco"></div>
                            Dashboards
                        </div>
                    </a>
                </div>

                <div class="divEspacoV2"></div>

                <div class="divHelp">
                    <p id="pHelp">HELP</p>
                </div>

                <div class="divPaiHelpMenu">
                    <a href="../suporte/SuporteHealthTooch.html" class="pMenuLateral">
                        <div class="divHelpDesk">
                            <img id="iconHelpDesk" src="../assets/img/suporte-ao-cliente.png">
                            <div class="divEspaco"></div>
                            HelpDesk
                        </div>
                    </a>
                    <a href="../atualizar/AtualizarUser.html" class="pMenuLateral">
                        <div class="divConfiguracoes">
                            <img id="iconConfiguracoes" src="../assets/img/botao-de-roda-dentada-de-configuracoes.png">
                            <div class="divEspaco"></div>
                            Configurações
                        </div>
                    </a>
                    <a href="../index.html">
                        <img id="logoMenuLateral" src="../assets/img/logoMenu.png">
                    </a>
                </div>
            </div>
        </div>
        <!-- fim do menu lateral -->

        <!-- inicio do cabeçalho -->
        <div class="divPaiCabecalho">
            <div class="filhoCabecalho">

                <div class="esquerdaCabecalho">
                    <input type="text" class="inputLogin" placeholder="Pesquisar"></input>
                    <img src="../assets/img/lupa.png" class="lupaBusca">
                </div>

                <div class="direitaCabecalho">
                    <img class="emailIconCabecalho" src="../assets/img/iconEmail.png">
                    <img class="sinoIconCabecalho" src="../assets/img/notificacaoIcon.png">
                    <div class="divPerfilCabecalho">
                        <img class="iconPerfilCabecalho" src="../assets/img/fotoPerfil.png">
                        <div class="textosIcon">
                            <p id="tituloPerfil">Anthony Bento</p>
                            <p id="cargoPerfil">CEO</p>
                        </div>
                        <img class="setaPerfilCabecalho" src="../assets/img/setaIcon.png" onclick="exibirMenuPerfil()">
                        <div id="menuPerfil" class="menuPerfil"
                            style="display: none; position: absolute; z-index: 1; top: 58px;">
                            <ul>
                                <button class="btnSair">
                                    <div class="sign"><svg viewBox="0 0 512 512">
                                            <path
                                                d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z">
                                            </path>
                                        </svg></div>

                                    <div class="txtBtn" onclick="limparSessao()">Sair</div>
                                </button>
                            </ul>
                        </div>
                    </div>
                </div>

            </div>
            <!-- fim do cabeçalho -->

            <!-- começo conteudo pagina -->
            <div class="divPaiConteudo">
                <div id="conteudo">
                    <div id="main">
                        <div id="cabecalho">
                            <div id="descricao">
                                <img src="../assets/img/lupaIndividual.png" alt="">

                                <p>Tenha mais controle sobre o desempenho de suas máquinas acompanhando seu histórico de
                                    alertas e medição</p>
                            </div>
                        </div>
                            <canvas id="grafico"></canvas>
                        
                        
                    </div>
                </div>
            </div>
        </div>
        <!-- fim conteudo pagina -->

    </div>
    </div>
</body>

</html>
<script>


    const chart = new Chart('grafico', {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'CPU',
                data: [],
                backgroundColor: 'blue',
                borderColor: 'blue',
                borderWidth: 1
            },
            {
                label: 'RAM',
                data: [],
                backgroundColor: 'red',
                borderColor: 'red',
                borderWidth: 1
            }]
            
        }
    });
    var data = [] 
    var quantidadeCPU = []
    var quantidadeRAM = []
    function atualizarGraficos(){
        chart.data.labels = data
        const datasets = chart.data.datasets
        datasets[0].data = quantidadeCPU
        datasets[1].data = quantidadeRAM
        chart.update()
    }
    // uma função que chama 12 vezes, e muda o tempo 
    // um grafico com 2 datasets, na X colocar o tempo de  12meesse(ajenri, fev, mar, abril,), Y eu quero a quantidade em cada mês 
    async function buscarMes() {
        data = []
        var idComputador = sessionStorage.ID_MAQUINA;
        try {
            var resposta = await fetch("/avisos/buscarMes", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    idComputadorServer: idComputador
                })
            });
            if (resposta.ok) {
                var respostaJson = await resposta.json();
                console.log('JSON CPU: ', respostaJson);

                for (let index = 0; index < respostaJson.length; index++) {
                    data.unshift(respostaJson[index].mes)
                }
                listarAvisosCPU()
            }
        } catch (erro) {
            console.log("Erro: ", erro);
        }
    }
    async function listarAvisosCPU() {  
        quantidadeCPU = []
        var idComputador = sessionStorage.ID_MAQUINA;
        try {
            var resposta = await fetch("/avisos/listarAvisosCPU", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    idComputadorServer: idComputador
                })
            });
            if (resposta.ok) {
                var respostaJson = await resposta.json();
                console.log('JSON CPU: ', respostaJson);

                for (let index = 0; index < respostaJson.length; index++) {
                    quantidadeCPU.unshift(respostaJson[index].total_de_avisos)
                }
                listarAvisosRAM()
            }
        } catch (erro) {
            console.log("Erro: ", erro);
        }
    }
    async function listarAvisosRAM() {
        
        quantidadeRAM = []
        var idComputador = sessionStorage.ID_MAQUINA;
        console.log(idComputador)
        try {
            var resposta = await fetch("/avisos/listarAvisosRAM", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    idComputadorServer: idComputador
                })
            });
            if (resposta.ok) {
                var respostaJson = await resposta.json();
                console.log('JSON RAM: ', respostaJson);
                for (let index = 0; index < respostaJson.length; index++) {
                    quantidadeRAM.unshift(respostaJson[index].total_de_avisos)
                }
                atualizarGraficos()
            }
        } catch (erro) {
            console.log("Erro: ", erro);
        }
    }
    function trocar() {
        window.location = "setores.html"
    }

    var nome = sessionStorage.NOME_COLABORADOR;
    tituloPerfil.innerHTML = nome;

    var cargo = sessionStorage.NIVELACESSO_COLABORADOR;
    if (cargo == "RL") {
        cargo = "Representante"
    } else if (cargo == "GT") {
        cargo = "Gerente TI"
    }



    var Empresa = sessionStorage.NOME_FANTASIA_COLABORADOR;
    nomeEmpresa.innerHTML = Empresa;

    function exibirMenuPerfil() {
        var menu = document.getElementById('menuPerfil')
        if (menu.style.display === 'block') {
            menu.style.display = 'none'
        } else {
            menu.style.display = 'block'
        }
    }


</script>