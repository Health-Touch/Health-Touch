<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gabriel Nunes | Health Touch</title>
    <link rel="stylesheet" href="../css/AnaliseTodosComp.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <link rel="shortcut icon" type="imagex/png" href="./assets/img/logo_icon.png" />
</head>

<style>
    .setaPerfilCabecalho:hover {
        cursor: pointer;
    }

    .menuPerfil ul {
        padding: 0;
    }

    .btnSair {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        width: 35px;
        height: 35px;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        position: relative;
        overflow: hidden;
        transition-duration: .3s;
        box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.199);
        background-color: rgb(255, 65, 65);
    }

    .btnSair:hover {
        width: 90px;
        border-radius: 40px;
        transition-duration: .3s;
    }

    .btnSair:hover .sign {
        width: 45%;
        transition-duration: .3s;
    }

    .btnSair:hover .txtBtn {
        opacity: 1;
        width: 70%;
        transition-duration: .3s;
    }

    .sign {
        width: 100%;
        transition-duration: .3s;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .sign svg {
        width: 17px;
    }

    .sign svg path {
        fill: white;
    }

    .txtBtn {
        position: absolute;
        right: 0%;
        width: 0%;
        opacity: 0;
        color: white;
        font-size: 1em;
        font-weight: 600;
        transition-duration: .3s;
    }
</style>

<body onload="">
    <div class="divPai">
        <!-- inicio menu lateral -->
        <div class="divPaiLateral">
            <div class="filhoLateral">

                <div class="divNomeEmpresa">

                    <p id="textoEmpresa">Bem Vindo</p>
                    <p id="nomeEmpresa">Bem Vindo <br><span> Nome da Empresa </span></p>
                </div>

                <div class="divMainMenu">
                    <p id="pMainMenu">MAIN MENU</p>
                </div>

                <div class="divPaiOpcoesMenu">
                    <a href="../setores.html" class="pMenuLateral">
                        <div class="divHome">
                            <img id="iconMenuLateralHome" src="../assets/img/grafico-de-setores.png">
                            <div class="divEspaco"></div>
                            Setores
                        </div>
                    </a>

                    <a href="../cadastro/cadastroMaquinas.html" class="pMenuLateral" id="SumirCadMaq">
                        <div class="divComputador">
                            <img id="iconComputadorLateral" src="../assets/img/computador (4).png">
                            <div class="divEspaco"></div>
                            Cadastro Máquinas
                        </div>
                    </a>

                    <a href="../analise/analiseMaquinaTI.html" class="pMenuLateral" id="SumirAnaliseMaq">
                        <div class="divCadastroComputador">
                            <img id="iconComputadorCadLateral" src="../assets/img/definicoes.png">
                            <div class="divEspaco"></div>
                            Análise Máquinas
                        </div>
                    </a>

                    <a href="../cadastro/cadastroFuncionarios.html" class="pMenuLateral" id="SumirCadEquipe">
                        <div class="divAnaliseEquipe" id="divAnaliseEquipe">
                            <img id="iconAnaliseEquipe" src="../assets/img/carteira-de-identidade.png">
                            <div class="divEspaco"></div>
                            Cadastro Equipe
                        </div>
                    </a>

                    <a href="../analise/analiseFuncionario.html" class="pMenuLateral" id="SumirAnaliseFunc">
                        <div class="divDashboards">
                            <img id="iconDashboardsLateral" src="../assets/img/equipe.png">
                            <div class="divEspaco"></div>
                            Análise Funcionários
                        </div>
                    </a>

                    <a href="" class="pMenuLateral">
                        <div class="divCadastroEquipe" id="divCadastroEquipe">
                            <img id="iconCadastroEquipe" src="../assets/img/mais (2).png">
                            <div class="divEspaco"></div>
                            Dashboards
                        </div>
                    </a>
                </div>

                <div class="divEspacoV2"></div>

                <div class="divHelp">
                    <p id="pHelp">HELP</p>
                </div>

                <div class="divPaiHelpMenu">
                    <a href="../suporte/SuporteHealthTooch.html" class="pMenuLateral">
                        <div class="divHelpDesk">
                            <img id="iconHelpDesk" src="../assets/img/suporte-ao-cliente.png">
                            <div class="divEspaco"></div>
                            HelpDesk
                        </div>
                    </a>
                    <a href="../atualizar/AtualizarUser.html" class="pMenuLateral">
                        <div class="divConfiguracoes">
                            <img id="iconConfiguracoes" src="../assets/img/botao-de-roda-dentada-de-configuracoes.png">
                            <div class="divEspaco"></div>
                            Configurações
                        </div>
                    </a>
                    <a href="../index.html">
                        <img id="logoMenuLateral" src="../assets/img/logoMenu.png">
                    </a>
                </div>
            </div>
        </div>
        <!-- fim do menu lateral -->

        <!-- inicio do cabeçalho -->
        <div class="divPaiCabecalho">
            <div class="filhoCabecalho">

                <!-- <div class="esquerdaCabecalho">
                    <input type="text" class="inputLogin" placeholder="Pesquisar"></input>
                    <img src="assets/img/lupa.png" class="lupaBusca">
                </div> -->

                <div class="direitaCabecalho">
                    <img class="emailIconCabecalho" src="../assets/img/iconEmail.png">
                    <img class="sinoIconCabecalho" src="../assets/img/notificacaoIcon.png">
                    <div class="divPerfilCabecalho">
                        <img class="iconPerfilCabecalho" src="../assets/img/fotoPerfil.png">
                        <div class="textosIcon">
                            <p id="tituloPerfil">Anthony Bento</p>
                            <p id="cargoPerfil">CEO</p>
                        </div>
                        <img class="setaPerfilCabecalho" src="../assets/img/setaIcon.png" onclick="exibirMenuPerfil()">
                        <div id="menuPerfil" class="menuPerfil"
                            style="display: none; position: absolute; z-index: 1; top: 58px;">
                            <ul>
                                <button class="btnSair">
                                    <div class="sign"><svg viewBox="0 0 512 512">
                                            <path
                                                d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z">
                                            </path>
                                        </svg></div>

                                    <div class="txtBtn" onclick="limparSessao()">Sair</div>
                                </button>
                            </ul>
                        </div>
                    </div>
                </div>

            </div>
            <!-- fim do cabeçalho -->

            <!-- começo conteudo pagina -->
            <div class="divPaiConteudo">
                <div class="div_kpi">
                    <div class="kpi">
                        <p>Uso atual CPU</p>
                        <h1 id="AtualCPU">10%</h1>
                    </div>
                    <div class="kpi">
                        <p>Uso atual RAM</p>
                        <h1 id="AtualRAM">80%</h1>
                    </div>
                    <div class="kpi">
                        <p>Uso atual DISCO</p>
                        <h1 id="AtualDisco">90%</h1>
                    </div>
                </div>
                <canvas id="myChart" class="grafico"></canvas>
            </div>
        </div>
    </div>
</body>

</html>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.5/dist/sweetalert2.all.min.js"></script>
<script>
    obterDadosGrafico();
    function obterDadosGrafico(idMaquina) {
        var idMaquina = sessionStorage.ID_MAQUINA


        fetch(`/medidas/relacaoComponentes/${idMaquina}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    resposta.reverse();

                    // plotarGraficoCpu(resposta, idMaquina);
                    separarListas(resposta)
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    var MedidasCPU = [];
    var MedidasRAM = [];
    var MedidasDISCO = [];

    function separarListas(resposta) {

        for (var i = 0; i < resposta.length; i++) {
            var registro = resposta[i];

            if (registro.fkComponente == 1) {
                MedidasCPU.push(registro.porcentagem);
            } else if (registro.fkComponente == 2) {
                MedidasDISCO.push(registro.porcentagem);
            } else if (registro.fkComponente == 3) {
                MedidasRAM.push(registro.porcentagem);
            }
        }

        UltimoValorComponente()

        var uniqueHours = new Set(resposta.map(item => item.DataHora));
        var uniqueHoursArray = [...uniqueHours];

        // var repeatedHoursArray = resposta.map(item => item.DataHora);

        // // Se você deseja repetir cada hora três vezes, por exemplo
        // repeatedHoursArray = repeatedHoursArray.flatMap(hour => Array(3).fill(hour));

        // Crie um gráfico usando Chart.js
        var ctx = document.getElementById("myChart").getContext("2d");
        var myChart = new Chart(ctx, {
            type: "line",
            data: {
                labels: uniqueHoursArray,
                datasets: [
                    {
                        label: "CPU",
                        data: MedidasCPU,
                        borderColor: "#020F1F",
                        fill: false,
                    },
                    {
                        label: "DISCO",
                        data: MedidasDISCO,
                        borderColor: "#26ABA7",
                        fill: false,
                    },
                    {
                        label: "RAM",
                        data: MedidasRAM,
                        borderColor: "#115ED2",
                        fill: false,
                    },
                ],
            }
        });

        setTimeout(() => {
            myChart.destroy();
            obterDadosGrafico();

        }, 30000);
    }

    function UltimoValorComponente() {
        var UltimaMedidasCPU = MedidasCPU[MedidasCPU.length - 1];
        AtualCPU.innerHTML = `${UltimaMedidasCPU}%`
        // AtualCPU.style.color = `#FF3FB9`
        console.log("Último valor:", UltimaMedidasCPU);

        var UltimaMedidasRAM = MedidasRAM[MedidasRAM.length - 1];
        AtualRAM.innerHTML = `${UltimaMedidasRAM}%`
        console.log("Último valor:", UltimaMedidasRAM);


        var UltimaMedidasDISCO =  MedidasDISCO[MedidasDISCO.length - 1];
        AtualDisco.innerHTML = `${UltimaMedidasDISCO}%`
        console.log("Último valor:", UltimaMedidasDISCO);
    }

    var nome = sessionStorage.NOME_COLABORADOR;
    tituloPerfil.innerHTML = nome;

    var Empresa = sessionStorage.NOME_FANTASIA_COLABORADOR;
    nomeEmpresa.innerHTML = Empresa;

    var cargo = sessionStorage.NIVELACESSO_COLABORADOR;

    if (cargo == "RL") {

        cargo = "Representante"
        SumirCadMaq.style.display = "none";
        SumirAnaliseMaq.style.display = "none";
        divAnaliseEquipe.style.top = "9%";

    } else if (cargo == "GT") {

        cargo = "Gerente TI"

    } else {
        cargo = "Equipe TI"
        SumirCadMaq.style.display = "none";
        SumirCadEquipe.style.display = "none";
        SumirAnaliseFunc.style.display = "none";
        divCadastroEquipe.style.top = "18%"
    }

    cargoPerfil.innerHTML = cargo

</script>